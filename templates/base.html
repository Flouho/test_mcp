<!DOCTYPE html>
<html lang="zh" data-theme="system">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}我的博客{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <svg style="display: none;">
        <symbol id="icon-home" viewBox="0 0 24 24"><path d="M12 2L2 12h3v8h6v-6h2v6h6v-8h3L12 2z"/></symbol>
        <symbol id="icon-edit" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></symbol>
        <symbol id="icon-info" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></symbol>
        <symbol id="icon-mail" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/></symbol>
    </svg>
    <script>
        // Theme switching logic
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'system';
        setTheme(savedTheme);

        // Sidebar toggle function
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const isCollapsed = sidebar.classList.toggle('collapsed');
            // Add/remove body class for mobile overlay effect only on mobile
            if (window.innerWidth < 768) {
                document.body.classList.toggle('sidebar-open', !isCollapsed);
            }
        }

        // Close sidebar function
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('collapsed');
            // Remove body class for mobile overlay effect only on mobile
            if (window.innerWidth < 768) {
                document.body.classList.remove('sidebar-open');
            }
        }

        // Optional: Close sidebar if clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.menu-toggle');
            // Check if click is outside sidebar and toggle button, and if sidebar is open on mobile
            if (window.innerWidth < 768 && !sidebar.contains(event.target) && !menuToggle.contains(event.target) && !sidebar.classList.contains('collapsed')) {
                closeSidebar();
            }
        });

        // Ensure body class is removed if window resizes from mobile to desktop with sidebar open
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768) {
                document.body.classList.remove('sidebar-open');
                // Optional: decide if sidebar should be open or closed by default on desktop resize
                // document.getElementById('sidebar').classList.remove('collapsed'); // Example: always open on resize to desktop
            } else {
                // Ensure body class is correct on resize to mobile
                const sidebar = document.getElementById('sidebar');
                document.body.classList.toggle('sidebar-open', !sidebar.classList.contains('collapsed'));
            }
        });

        // Initial check on load for mobile
        if (window.innerWidth < 768) {
            const sidebar = document.getElementById('sidebar');
            if (!sidebar.classList.contains('collapsed')) {
                document.body.classList.add('sidebar-open');
            }
        }
    </script>
</head>
<body>
    <div class="layout">
        <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
        <aside class="sidebar" id="sidebar">
            <h1 class="logo">我的博客</h1>
            <nav class="nav">
                <a href="{{ url_for('index') }}" class="nav-link active">
                    <svg class="icon"><use xlink:href="#icon-home"></use></svg>
                    <span>首页</span>
                </a>
                <a href="{{ url_for('create') }}" class="nav-link">
                    <svg class="icon"><use xlink:href="#icon-edit"></use></svg>
                    <span>写文章</span>
                </a>
                <a href="{{ url_for('about') }}" class="nav-link">
                    <svg class="icon"><use xlink:href="#icon-info"></use></svg>
                    <span>关于</span>
                </a>
                <a href="{{ url_for('contact') }}" class="nav-link">
                    <svg class="icon"><use xlink:href="#icon-mail"></use></svg>
                    <span>联系</span>
                </a>
            </nav>
            <div class="theme-colors">
                <div class="theme-color" style="background: #2563eb;" onclick="setTheme('light')" title="浅色主题"></div>
                <div class="theme-color" style="background: #60a5fa;" onclick="setTheme('dark')" title="深色主题"></div>
                <div class="theme-color" style="background: linear-gradient(135deg, #2563eb 50%, #1e293b 50%);" onclick="setTheme('system')" title="系统主题"></div>
            </div>
            <button class="close-sidebar" onclick="toggleSidebar()">«</button>
        </aside>
        <main class="content">
            {% block content %}{% endblock %}
        </main>
    </div>
</body>
</html>
